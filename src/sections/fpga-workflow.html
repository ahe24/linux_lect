<section id="fpga-workflow" class="content-section">

    <h1>FPGA Simulation Workflow</h1>
    <p>FPGA ê°œë°œì˜ ê½ƒì€ ì‹œë®¬ë ˆì´ì…˜ì…ë‹ˆë‹¤. Questasimê³¼ Vivadoë¥¼ ë¦¬ëˆ…ìŠ¤ í„°ë¯¸ë„(Makefile)ì—ì„œ ì œì–´í•˜ëŠ” ë°©ë²•ì„ ë§ˆìŠ¤í„°í•˜ì„¸ìš”.</p>

    <h2>1. Makefileì´ë€? (ì´ˆë³´ì í•„ë…)</h2>
    <p><strong>Makefile</strong>ì€ ì—¬ëŸ¬ ëª…ë ¹ì–´ë¥¼ í•˜ë‚˜ì˜ ë‹¨ì¶•í‚¤ì²˜ëŸ¼ ë¬¶ì–´ ì‹¤í–‰í•˜ëŠ” ìë™í™” ë„êµ¬ì…ë‹ˆë‹¤. GUI ì—†ì´ í„°ë¯¸ë„ì—ì„œ ë³µì¡í•œ ì‹œë®¬ë ˆì´ì…˜ì„ ì œì–´í•  ë•Œ í•„ìˆ˜ì…ë‹ˆë‹¤.</p>

    <div class="note-box">
        <i data-lucide="lightbulb"></i>
        <div>
            <strong>ì™œ í•„ìš”í•œê°€ìš”?</strong><br>
            ì‹œë®¬ë ˆì´ì…˜ í•œ ë²ˆ ëŒë¦¬ë ¤ë©´ ë³´í†µ 5~10ê°œ ëª…ë ¹ì–´ë¥¼ ìˆœì„œëŒ€ë¡œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤. Makefileì„ ì“°ë©´ <code>make sim</code> ë‹¨ í•œ ì¤„ë¡œ ëª¨ë“  ì‘ì—…ì´ ìë™ ì‹¤í–‰ë©ë‹ˆë‹¤.
        </div>
    </div>

    <h3>í•µì‹¬ êµ¬ì¡° (Targetê³¼ Dependencies)</h3>
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:20px;">
        <div class="syntax-card" style="border-left-color: var(--vim-green);">
            <strong style="color:var(--vim-green); font-size:1.1em;">1. Target (ëª©í‘œ ì‘ì—… ì •ì˜)</strong>
            <p style="margin-top:10px; color:var(--text-secondary);">ì‹¤í–‰í•˜ê³  ì‹¶ì€ ì‘ì—…ì˜ ì´ë¦„ê³¼ ì‹¤ì œ ëª…ë ¹ì–´ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.</p>
            <pre style="margin-top:10px;"><code class="language-makefile"># ì»´íŒŒì¼ ì‘ì—…
compile:
	vlib work
	vlog top.v tb.v

# ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
sim:
	vsim -c work.tb -do "run -all"

# ì •ë¦¬ ì‘ì—…
clean:
	rm -rf work *.log</code></pre>
        </div>
        <div class="syntax-card" style="border-left-color: #ff6b6b;">
            <strong style="color:#ff6b6b; font-size:1.1em;">2. Dependencies (ì˜ì¡´ì„± í™œìš©)</strong>
            <p style="margin-top:10px; color:var(--text-secondary);">ì½œë¡ (:) ë’¤ì— ë¨¼ì € ì‹¤í–‰ë˜ì–´ì•¼ í•  ì‘ì—…ì„ ëª…ì‹œí•©ë‹ˆë‹¤.</p>
            <pre style="margin-top:10px;"><code class="language-makefile"># sim ì‹¤í–‰ ì „ compile ìë™ ì‹¤í–‰
sim: compile
	vsim -do "run -all"

# allì€ ëª¨ë“  ë‹¨ê³„ ìˆœì°¨ ì‹¤í–‰
all: clean compile sim</code></pre>
            <div
                style="margin-top:10px; padding:10px; background:rgba(88,166,255,0.1); border-radius:4px; font-size:0.9em;">
                ğŸ’¡ <code>make sim</code> ì…ë ¥ ì‹œ:<br>
                1. compile ë¨¼ì € ì‹¤í–‰<br>
                2. ì™„ë£Œ í›„ sim ì‹¤í–‰
            </div>
        </div>
    </div>

    <h3>ê¼­ ì•Œì•„ì•¼ í•  ë¬¸ë²• ê·œì¹™</h3>
    <div class="note-box">
        <i data-lucide="alert-circle"></i>
        <div>
            <strong>âš ï¸ TAB ë¬¸ì í•„ìˆ˜!</strong><br>
            ëª…ë ¹ì–´ ì•ì—ëŠ” ë°˜ë“œì‹œ <strong>TAB</strong> ë¬¸ì(ìŠ¤í˜ì´ìŠ¤ ì•„ë‹˜)ê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ìŠ¤í˜ì´ìŠ¤ë¡œ ë“¤ì—¬ì“°ê¸°í•˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.
            <pre style="margin-top:10px; background:rgba(0,0,0,0.3); padding:10px;"><code class="language-makefile">clean:
	rm -rf work
â†‘
ì´ ë¶€ë¶„ì´ TAB ë¬¸ìì—¬ì•¼ í•¨!</code></pre>
        </div>
    </div>

    <h3>ê°„ë‹¨í•œ ì˜ˆì‹œë¡œ ì´í•´í•˜ê¸°</h3>
    <div style="display:flex; gap:20px; flex-wrap:wrap; margin-bottom:30px;">
        <div style="flex:1; min-width:300px;">
            <h4 style="margin-top:0; color:var(--text-secondary); font-size:1rem;">ë¬¸ì œ ìƒí™© (ìˆ˜ë™ ì‹¤í–‰)</h4>
            <pre><code class="language-bash"># ë§¤ë²ˆ ì´ë ‡ê²Œ 4ì¤„ì„ íƒ€ì´í•‘í•´ì•¼ í•¨
vlib work
vlog top.v
vlog tb.v
vsim -do "run -all"</code></pre>
        </div>
        <div style="flex:1; min-width:300px;">
            <h4 style="margin-top:0; color:var(--vim-green); font-size:1rem;">í•´ê²°ì±… (Makefile)</h4>
            <pre><code class="language-makefile">sim:
	vlib work
	vlog top.v
	vlog tb.v
	vsim -do "run -all"</code></pre>
            <p style="margin-top:10px; color:var(--text-secondary); font-size:0.9em;">ì´ì œ í„°ë¯¸ë„ì—ì„œ <code>make sim</code> í•œ
                ì¤„ë§Œ ì…ë ¥í•˜ë©´ ë!</p>
        </div>
    </div>

    <h2>2. Questasim Makefile ì™„ë²½ ë¶„ì„</h2>
    <p>ë‹¨ìˆœíˆ ë³µì‚¬í•´ì„œ ì“°ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ê° ëª…ë ¹ì–´ì˜ ì˜ë¯¸ë¥¼ ì´í•´í•´ì•¼ ì—ëŸ¬ë¥¼ ì¡ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

    <div class="note-box">
        <i data-lucide="book-open"></i>
        <div>
            <strong>í•µì‹¬ ëª…ë ¹ì–´ ì„¤ëª…:</strong>
            <ul style="list-style: disc; margin-left: 20px; margin-top: 10px;">
                <li><code>vlib work</code>: ì»´íŒŒì¼ëœ ë””ìì¸ ìœ ë‹›ë“¤ì´ ì €ì¥ë  ë¬¼ë¦¬ì ì¸ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</li>
                <li><code>vmap work work</code>: ë…¼ë¦¬ì ì¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ë¦„(work)ì„ ë¬¼ë¦¬ì  ë””ë ‰í† ë¦¬ì— ë§¤í•‘í•©ë‹ˆë‹¤.</li>
                <li><code>vlog</code>: Verilog/SystemVerilog ì»´íŒŒì¼ëŸ¬. <code>+incdir+</code> ì˜µì…˜ìœ¼ë¡œ í—¤ë” íŒŒì¼ ê²½ë¡œë¥¼ ì§€ì •í•˜ëŠ” ê²ƒì´ í•„ìˆ˜ì…ë‹ˆë‹¤.
                </li>
                <li><code>vopt</code>: <strong>Visualizer ìµœì í™”</strong>. <code>-o opt -debug +designfile</code> ì˜µì…˜ìœ¼ë¡œ ë””ë²„ê·¸
                    ì •ë³´ê°€
                    í¬í•¨ëœ ìµœì í™” ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</li>
                <li><code>vsim</code>: <code>-qwavedb=+signal</code> ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ Visualizerìš© ê³ ì† ì‹œë®¬ë ˆì´ì…˜ DBë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</li>
            </ul>
        </div>
    </div>

    <pre><code class="language-makefile"># Makefile for Questasim (Visualizer Flow)
RTL_DIR = ../src
TB_DIR  = ../tb
WORK    = work
RTL_LIST = ../sim/run.f
TOP     = tb_top
OPT     = opt

# Visualizer GUI Live Simulation (with QWaveDB)
gui: clean compiled optimize
	vsim $(OPT) -visualizer -qwavedb=+signal -do "run 10 us"

# Batch / Post simulation mode
sim: clean compiled optimize
	vsim -batch $(OPT) -qwavedb=+signal -do "run -all; quit"

optimize:
	# vopt: Optimize & Debug options (+designfile for Visualizer)
	vopt $(WORK).$(TOP) -o $(OPT) -debug +designfile -L $(WORK)

compiled:
	vlib $(WORK)
	vmap work $(WORK)
	vlog -work $(WORK) +incdir+$(RTL_DIR) -f $(RTL_LIST)
	vlog -work $(WORK) +incdir+$(TB_DIR) $(TB_DIR)/$(TOP).v

# load wave database for visualizer
wave: 
	vis design.bin qwave.db &

clean:
	rm -rf $(WORK) transcript vsim.wlf qwave.db visualizer.log</code></pre>

    <div class="note-box">
        <i data-lucide="file-text"></i>
        <div>
            <strong>run.f íŒŒì¼ ì˜ˆì‹œ:</strong><br />
            ì™€ì¼ë“œì¹´ë“œ(*.v)ëŠ” íŒŒì¼ ë¡œë“œ ìˆœì„œë¥¼ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ìƒìœ„ ëª¨ë“ˆì´ í•˜ìœ„ ëª¨ë“ˆë³´ë‹¤ ë¨¼ì € ì˜¤ì§€ ì•Šë„ë¡, íŒŒì¼ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì˜ì¡´ì„± ìˆœì„œëŒ€ë¡œ ëª…ì‹œí•˜ëŠ” ê²ƒì´ ì •ì„ì…ë‹ˆë‹¤.
            <pre><code class="language-plaintext" style="margin-top: 10px; background: #000; padding: 10px;">// ì£¼ì„ ê°€ëŠ¥
../src/defines.v
../src/alu.v
../src/cpu_top.v
</code></pre>
        </div>
    </div>

    <h2>3. Vivado ë°°í¬/í•©ì„± ìë™í™” (Batch Mode)</h2>
    <p>Vivadoì—ì„œë„ íŒŒì¼ ë¦¬ìŠ¤íŠ¸(sources.f)ë¥¼ Tclë¡œ íŒŒì‹±í•˜ì—¬ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ìœ ì§€ë³´ìˆ˜ì— ì¢‹ìŠµë‹ˆë‹¤.</p>
    <pre><code class="language-makefile"># Makefile for Vivado
bitstream: 
	vivado -mode batch -source run_synth.tcl</code></pre>

    <h3>ì˜ˆì‹œ: run_synth.tcl (íŒŒì¼ ë¦¬ìŠ¤íŠ¸ + IP + Include ê²½ë¡œ)</h3>
    <pre><code class="language-tcl"># run_synth.tcl
create_project -in_memory -part xc7a35ticsg324-1L

# Verilog Include ê²½ë¡œ ì„¤ì • (í—¤ë” íŒŒì¼ì´ ìˆëŠ” ë””ë ‰í† ë¦¬)
set_property include_dirs {../src/include ../ip/include} [current_fileset]

# íŒŒì¼ ë¦¬ìŠ¤íŠ¸ ì½ê¸° í•¨ìˆ˜
set fp [open "sources.f" r]
set file_data [read $fp]
close $fp

# ë¼ì¸ë³„ë¡œ ì½ì–´ì„œ íŒŒì¼ í˜•ì‹ì— ë§ê²Œ ì²˜ë¦¬
foreach line [split $file_data "\n"] {
    # ë¹ˆ ì¤„ì´ë‚˜ ì£¼ì„(#) ì œì™¸
    if {[string length $line] > 0 && ![string match "#*" $line]} {
        # íŒŒì¼ í™•ì¥ìì— ë”°ë¼ ë‹¤ë¥¸ ëª…ë ¹ì–´ ì‚¬ìš©
        if {[string match "*.xci" $line]} {
            # Xilinx IP íŒŒì¼ (.xci)
            read_ip $line
        } elseif {[string match "*.vhd" $line] || [string match "*.vhdl" $line]} {
            # VHDL íŒŒì¼
            read_vhdl $line
        } elseif {[string match "*.v" $line] || [string match "*.sv" $line]} {
            # Verilog/SystemVerilog íŒŒì¼
            read_verilog $line
        }
    }
}

read_xdc ../const/pins.xdc

synth_design -top top_module -part xc7a35ticsg324-1L
opt_design
place_design
route_design
write_bitstream -force ./build_output/final.bit</code></pre>

    <div class="note-box">
        <i data-lucide="lightbulb"></i>
        <div>
            <strong>sources.f íŒŒì¼ ì˜ˆì‹œ (Verilog + VHDL + IP í˜¼í•©):</strong><br>
            ë‹¤ì–‘í•œ íŒŒì¼ í˜•ì‹ì„ í•˜ë‚˜ì˜ ë¦¬ìŠ¤íŠ¸ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            <pre style="margin-top:10px; background:rgba(0,0,0,0.3); padding:10px;"><code class="language-plaintext"># Verilog RTL
../src/defines.v
../src/alu.v

# SystemVerilog
../src/cpu_top.sv

# VHDL ì„œë“œíŒŒí‹° IP (ì˜ˆ: ì•”í˜¸í™” ëª¨ë“ˆ)
../src/crypto/aes_core.vhd

# Xilinx IP Cores
../ip/clk_wiz_0/clk_wiz_0.xci
../ip/fifo_generator_0/fifo_generator_0.xci</code></pre>
        </div>
    </div>

    <div class="note-box">
        <i data-lucide="info"></i>
        <div>
            <strong>Include ê²½ë¡œ ì„¤ì • ì´ìœ :</strong><br>
            Verilog ì½”ë“œì—ì„œ <code>`include "config.vh"</code> ê°™ì€ í—¤ë” íŒŒì¼ì„ ì‚¬ìš©í•  ë•Œ, í•©ì„± íˆ´ì´ í•´ë‹¹ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ìˆë„ë¡ ê²½ë¡œë¥¼ ëª…ì‹œí•´ì•¼ í•©ë‹ˆë‹¤.
            <code>set_property include_dirs</code>ë¡œ ì—¬ëŸ¬ ë””ë ‰í† ë¦¬ë¥¼ ì§€ì •í•˜ë©´ ìë™ìœ¼ë¡œ ê²€ìƒ‰ë©ë‹ˆë‹¤.
        </div>
    </div>
</section>